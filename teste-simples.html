<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Simples - LeadCapture</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .debug {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Simples - LeadCapture</h1>
        
        <p>Este √© um teste simplificado para verificar se o LeadCapture est√° funcionando.</p>
        
        <div>
            <button class="btn" onclick="testarModal()">Abrir Modal</button>
            <button class="btn" onclick="verificarEstado()">Verificar Estado</button>
            <button class="btn" onclick="limparDados()">Limpar Dados</button>
        </div>
        
        <div class="debug" id="debugInfo">
            Clique em "Verificar Estado" para ver as informa√ß√µes...
        </div>
    </div>

    <!-- Modal Simples -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <h2>Teste de Modal</h2>
            <form id="leadForm">
                <div class="form-group">
                    <label for="leadName">Nome:</label>
                    <input type="text" id="leadName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="leadEmail">Email:</label>
                    <input type="email" id="leadEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="leadPhone">Telefone:</label>
                    <input type="tel" id="leadPhone" name="phone" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="leadTerms" name="terms" required>
                        Aceito os termos
                    </label>
                </div>
                <button type="submit" class="btn">Enviar</button>
            </form>
        </div>
    </div>

    <script>
        // Classe LeadCapture Simplificada
        class LeadCapture {
            constructor() {
                console.log('üèóÔ∏è Construtor LeadCapture iniciado...');
                
                this.modal = document.getElementById('leadModal');
                this.form = document.getElementById('leadForm');
                this.nameInput = document.getElementById('leadName');
                this.emailInput = document.getElementById('leadEmail');
                this.phoneInput = document.getElementById('leadPhone');
                this.termsInput = document.getElementById('leadTerms');
                
                console.log('üîç Elementos encontrados:', {
                    modal: !!this.modal,
                    form: !!this.form,
                    nameInput: !!this.nameInput,
                    emailInput: !!this.emailInput,
                    phoneInput: !!this.phoneInput,
                    termsInput: !!this.termsInput
                });
                
                this.init();
                console.log('‚úÖ Construtor LeadCapture finalizado');
            }
            
            init() {
                console.log('üîß Inicializando LeadCapture...');
                
                // Verificar se j√° est√° autenticado
                if (!this.isAuthenticated()) {
                    console.log('üîì Usu√°rio n√£o autenticado - exibindo modal');
                    this.showModal();
                } else {
                    console.log('‚úÖ Usu√°rio j√° autenticado - escondendo modal');
                    this.hideModal();
                }
                
                // Listener para o form
                if (this.form) {
                    this.form.addEventListener('submit', (e) => this.handleSubmit(e));
                }
                
                console.log('‚úÖ LeadCapture inicializado com sucesso');
            }
            
            isAuthenticated() {
                const authData = localStorage.getItem('canvas-lead-auth');
                console.log('üîç Verificando autentica√ß√£o...', authData ? 'Dados encontrados' : 'Nenhum dado');
                
                if (!authData) return false;
                
                try {
                    const parsed = JSON.parse(authData);
                    const expiryDate = new Date(parsed.expiry);
                    const now = new Date();
                    
                    console.log('üìÖ Data de expira√ß√£o:', expiryDate.toISOString());
                    console.log('üìÖ Data atual:', now.toISOString());
                    console.log('‚è∞ Expirou?', now > expiryDate);
                    
                    if (now > expiryDate) {
                        localStorage.removeItem('canvas-lead-auth');
                        console.log('üóëÔ∏è Autentica√ß√£o expirada - removida');
                        return false;
                    }
                    
                    console.log('‚úÖ Usu√°rio autenticado e v√°lido');
                    return true;
                } catch (error) {
                    console.error('‚ùå Erro ao verificar autentica√ß√£o:', error);
                    localStorage.removeItem('canvas-lead-auth');
                    return false;
                }
            }
            
            async handleSubmit(event) {
                event.preventDefault();
                console.log('üìù Processando submiss√£o do formul√°rio...');
                
                const formData = {
                    name: this.nameInput.value.trim(),
                    email: this.emailInput.value.trim(),
                    phone: this.phoneInput.value.trim(),
                    terms: this.termsInput.checked,
                    created_at: new Date().toISOString(),
                    source: 'teste-simples'
                };
                
                console.log('üìã Dados do formul√°rio:', formData);
                
                // Valida√ß√µes
                if (!formData.name || !formData.email || !formData.phone) {
                    alert('‚ùå Por favor, preencha todos os campos obrigat√≥rios.');
                    return;
                }
                
                if (!formData.terms) {
                    alert('‚ùå Voc√™ deve aceitar os termos.');
                    return;
                }
                
                console.log('‚úÖ Valida√ß√µes passaram - processando dados...');
                
                try {
                    // Salvar autentica√ß√£o local (30 dias)
                    const expiryDate = new Date();
                    expiryDate.setDate(expiryDate.getDate() + 30);
                    
                    localStorage.setItem('canvas-lead-auth', JSON.stringify({
                        authenticated: true,
                        lead: formData,
                        expiry: expiryDate.toISOString(),
                        date: new Date().toISOString()
                    }));
                    
                    console.log('üíæ Autentica√ß√£o salva localmente');
                    
                    this.hideModal();
                    alert('‚úÖ Acesso liberado! Bem-vindo, ' + formData.name + '!');
                    
                } catch (error) {
                    console.error('Erro ao processar lead:', error);
                    alert('‚ùå Ocorreu um erro. Tente novamente.');
                }
            }
            
            showModal() {
                if (this.modal) {
                    this.modal.style.display = 'flex';
                    console.log('‚úÖ Modal exibido com sucesso');
                } else {
                    console.error('‚ùå Modal n√£o encontrado');
                }
            }
            
            hideModal() {
                if (this.modal) {
                    this.modal.style.display = 'none';
                    console.log('‚úÖ Modal escondido com sucesso');
                } else {
                    console.error('‚ùå Modal n√£o encontrado');
                }
            }
        }

        // Fun√ß√µes de teste
        function testarModal() {
            console.log('üß™ Testando modal...');
            if (window.leadCapture) {
                window.leadCapture.showModal();
            } else {
                console.error('‚ùå LeadCapture n√£o encontrado');
                alert('‚ùå LeadCapture n√£o encontrado. Verifique o console para mais detalhes.');
            }
        }

        function limparDados() {
            console.log('üóëÔ∏è Limpando dados...');
            localStorage.removeItem('canvas-lead-auth');
            alert('‚úÖ Dados limpos! Recarregue a p√°gina para testar novamente.');
        }

        function verificarEstado() {
            const debugInfo = document.getElementById('debugInfo');
            const info = {
                'LeadCapture dispon√≠vel': !!window.leadCapture,
                'Modal encontrado': !!document.getElementById('leadModal'),
                'Formul√°rio encontrado': !!document.getElementById('leadForm'),
                'Dados de autentica√ß√£o': localStorage.getItem('canvas-lead-auth'),
                'Console logs': 'Abra o console (F12) para ver os logs detalhados'
            };
            
            debugInfo.textContent = JSON.stringify(info, null, 2);
            console.log('üîç Estado atual:', info);
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOMContentLoaded - Iniciando inicializa√ß√£o...');
            
            try {
                console.log('üîß Criando LeadCapture...');
                window.leadCapture = new LeadCapture();
                console.log('‚úÖ LeadCapture criado:', !!window.leadCapture);
                
                console.log('üéâ Inicializa√ß√£o completa!');
            } catch (error) {
                console.error('‚ùå Erro durante inicializa√ß√£o:', error);
            }
        });
    </script>
</body>
</html>
